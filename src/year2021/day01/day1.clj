(ns year2021.day01.day1
  (:require [ysera.test :refer [is is= is-not]]
            [clojure.string :as str :only [index-of]]))

; https://adventofcode.com/2021/day/1

(defn diffs
  {:doc  "
  Count the number of times a depth measurement increases"
   :test (fn []
           (is= (diffs [199 200 208 210 200 207 240 269 260 263]) '(1 8 2 -10 7 33 29 -9 3))
           (is= (diffs [607 618 618 617 647 716 769 792]) '(11 0 -1 30 69 53 23))
           )}
  [m]
    (map - (drop 1 m) (drop-last 1 m))
  )

(defn floating-average-3
  {:doc  "
  Count the number of times a depth measurement increases"
   :test (fn []
           (is= (floating-average-3 [199 200 208 210 200 207 240 269 260 263])
                '(607 618 618 617 647 716 769 792))
           )}
  [m]
    (map + (drop-last 2 m) (drop 1 (drop-last 1 m)) (drop 2 m))
  )

(defn increments
  {:doc  "
  Count the number of times a depth measurement increases"
   :test (fn []
           (is= (increments [1 8 2 -10 7 33 29 -9 3]) 7)
           (is= (increments [11 0 -1 30 69 53 23]) 5)
           )}
  [diffs]
  (->> diffs
       (filter pos?)
       (count)
       )
  )

(defn part1
  [nums]
  (->> nums
       (str/split-lines)
       (map read-string)
       (diffs)
       (increments)
       )
  )

(defn part2
  [nums]
  (->> nums
       (str/split-lines)
       (map read-string)
       (floating-average-3)
       (diffs)
       (increments)
       )
  )

(comment
  (def puzzle-input "104\n111\n124\n139\n142\n141\n144\n151\n152\n154\n157\n156\n157\n149\n123\n118\n129\n133\n134\n130\n124\n102\n103\n105\n104\n99\n100\n101\n103\n116\n114\n129\n135\n147\n149\n148\n149\n137\n140\n149\n159\n157\n159\n165\n164\n170\n176\n180\n192\n198\n200\n202\n203\n202\n211\n212\n230\n233\n237\n229\n226\n229\n234\n242\n245\n244\n242\n256\n258\n262\n267\n269\n285\n274\n279\n270\n302\n305\n308\n320\n323\n324\n323\n325\n358\n361\n367\n364\n363\n351\n352\n350\n349\n355\n356\n359\n367\n375\n405\n413\n417\n425\n428\n436\n437\n438\n430\n429\n430\n431\n442\n451\n459\n460\n473\n481\n482\n483\n485\n491\n501\n499\n532\n533\n538\n540\n514\n505\n511\n508\n509\n507\n519\n521\n492\n493\n498\n497\n499\n510\n508\n501\n507\n509\n528\n529\n539\n545\n546\n575\n577\n599\n600\n602\n609\n634\n635\n637\n652\n660\n692\n677\n676\n679\n682\n683\n684\n688\n687\n688\n709\n708\n710\n713\n714\n729\n724\n723\n725\n728\n727\n722\n728\n759\n760\n764\n771\n754\n768\n761\n767\n798\n791\n811\n812\n831\n834\n842\n854\n855\n863\n864\n868\n882\n887\n891\n899\n902\n903\n906\n908\n915\n943\n937\n941\n928\n941\n928\n922\n924\n940\n950\n949\n950\n951\n947\n948\n955\n958\n960\n963\n956\n955\n957\n960\n965\n966\n967\n968\n969\n977\n945\n929\n925\n926\n939\n943\n944\n956\n965\n961\n968\n967\n966\n970\n968\n973\n975\n990\n1003\n1005\n1006\n1009\n1011\n1009\n1015\n1016\n1015\n1000\n1005\n1009\n1005\n1011\n1008\n1017\n1016\n1017\n1018\n1013\n1012\n1015\n1012\n1003\n1004\n1005\n1008\n1016\n1021\n1023\n1051\n1052\n1057\n1059\n1067\n1064\n1060\n1062\n1071\n1065\n1077\n1079\n1081\n1085\n1091\n1089\n1092\n1093\n1103\n1083\n1102\n1111\n1113\n1120\n1131\n1132\n1152\n1153\n1162\n1161\n1160\n1145\n1154\n1159\n1148\n1160\n1161\n1162\n1187\n1193\n1184\n1192\n1190\n1191\n1196\n1200\n1205\n1207\n1209\n1208\n1209\n1210\n1211\n1223\n1225\n1226\n1227\n1217\n1211\n1212\n1216\n1209\n1210\n1219\n1218\n1219\n1220\n1219\n1220\n1215\n1242\n1246\n1247\n1233\n1264\n1297\n1284\n1288\n1313\n1333\n1339\n1334\n1341\n1345\n1351\n1350\n1353\n1349\n1352\n1351\n1352\n1353\n1355\n1333\n1334\n1335\n1336\n1337\n1309\n1316\n1315\n1316\n1325\n1343\n1345\n1347\n1334\n1337\n1336\n1337\n1343\n1346\n1347\n1342\n1328\n1326\n1327\n1328\n1320\n1324\n1334\n1336\n1337\n1338\n1348\n1350\n1358\n1374\n1377\n1380\n1366\n1368\n1372\n1376\n1377\n1380\n1382\n1392\n1396\n1402\n1407\n1408\n1423\n1428\n1422\n1424\n1427\n1440\n1439\n1438\n1454\n1460\n1461\n1462\n1466\n1471\n1470\n1448\n1455\n1460\n1470\n1480\n1488\n1497\n1502\n1503\n1505\n1502\n1503\n1510\n1519\n1523\n1526\n1527\n1526\n1530\n1526\n1536\n1534\n1539\n1553\n1557\n1562\n1569\n1570\n1584\n1601\n1564\n1577\n1582\n1584\n1585\n1586\n1589\n1583\n1595\n1608\n1612\n1610\n1605\n1611\n1615\n1619\n1620\n1621\n1624\n1626\n1628\n1621\n1635\n1637\n1645\n1646\n1656\n1658\n1657\n1667\n1672\n1674\n1675\n1678\n1692\n1693\n1696\n1713\n1714\n1715\n1734\n1736\n1738\n1756\n1757\n1780\n1772\n1777\n1776\n1783\n1786\n1792\n1791\n1792\n1797\n1799\n1794\n1811\n1795\n1793\n1780\n1782\n1791\n1789\n1800\n1799\n1797\n1814\n1812\n1818\n1842\n1853\n1871\n1872\n1876\n1877\n1882\n1883\n1874\n1876\n1879\n1893\n1894\n1911\n1877\n1880\n1883\n1884\n1887\n1885\n1892\n1897\n1912\n1917\n1931\n1934\n1935\n1926\n1930\n1945\n1943\n1942\n1943\n1941\n1943\n1947\n1941\n1950\n1955\n1980\n1981\n1986\n1987\n2000\n2005\n1999\n2009\n2010\n2006\n1998\n1999\n2009\n2016\n2017\n1984\n1985\n1986\n1985\n1988\n2011\n2018\n2019\n2023\n2026\n2034\n2041\n2043\n2060\n2068\n2072\n2079\n2082\n2083\n2077\n2109\n2111\n2118\n2146\n2149\n2151\n2148\n2147\n2137\n2138\n2128\n2138\n2139\n2163\n2164\n2194\n2196\n2197\n2198\n2199\n2201\n2211\n2242\n2244\n2248\n2225\n2226\n2235\n2231\n2232\n2233\n2234\n2237\n2233\n2232\n2235\n2217\n2228\n2234\n2235\n2234\n2237\n2238\n2249\n2250\n2252\n2273\n2261\n2278\n2279\n2275\n2274\n2273\n2271\n2284\n2289\n2282\n2284\n2282\n2283\n2286\n2288\n2302\n2321\n2360\n2368\n2369\n2364\n2373\n2379\n2378\n2386\n2391\n2398\n2399\n2400\n2401\n2409\n2416\n2414\n2413\n2412\n2418\n2406\n2429\n2449\n2446\n2449\n2438\n2448\n2450\n2413\n2422\n2424\n2425\n2429\n2430\n2431\n2426\n2428\n2431\n2417\n2419\n2420\n2427\n2421\n2424\n2433\n2434\n2435\n2436\n2462\n2440\n2443\n2442\n2454\n2455\n2458\n2447\n2448\n2450\n2455\n2462\n2464\n2472\n2477\n2482\n2483\n2501\n2511\n2516\n2517\n2514\n2520\n2521\n2525\n2539\n2553\n2554\n2543\n2548\n2544\n2552\n2551\n2553\n2589\n2588\n2594\n2599\n2614\n2615\n2629\n2630\n2639\n2644\n2646\n2665\n2657\n2668\n2669\n2681\n2680\n2684\n2691\n2693\n2686\n2681\n2680\n2683\n2687\n2694\n2696\n2698\n2702\n2690\n2694\n2693\n2698\n2707\n2716\n2714\n2713\n2714\n2724\n2747\n2748\n2750\n2752\n2760\n2756\n2757\n2755\n2756\n2762\n2765\n2778\n2777\n2778\n2777\n2775\n2778\n2770\n2762\n2754\n2755\n2757\n2770\n2771\n2784\n2815\n2836\n2837\n2838\n2839\n2847\n2848\n2850\n2826\n2806\n2820\n2826\n2827\n2832\n2837\n2848\n2859\n2866\n2865\n2873\n2874\n2876\n2879\n2886\n2861\n2865\n2876\n2875\n2872\n2874\n2879\n2889\n2899\n2908\n2909\n2915\n2903\n2915\n2925\n2918\n2919\n2920\n2936\n2932\n2922\n2923\n2935\n2940\n2947\n2969\n2963\n2940\n2944\n2945\n2949\n2964\n2967\n2968\n2985\n2986\n2973\n2974\n2969\n2970\n2965\n2966\n2967\n2953\n2957\n2956\n2964\n2977\n2974\n2983\n2996\n2994\n2992\n2999\n2988\n2974\n2980\n2985\n2986\n2993\n3007\n3008\n3007\n3014\n3013\n3031\n3027\n3029\n3026\n3027\n3035\n3036\n3037\n3052\n3054\n3055\n3059\n3057\n3059\n3058\n3064\n3063\n3065\n3066\n3070\n3072\n3104\n3111\n3103\n3111\n3112\n3138\n3137\n3150\n3137\n3138\n3139\n3142\n3154\n3156\n3157\n3158\n3160\n3152\n3157\n3143\n3147\n3159\n3161\n3162\n3160\n3163\n3164\n3160\n3161\n3167\n3181\n3182\n3190\n3191\n3193\n3192\n3193\n3205\n3206\n3216\n3229\n3230\n3228\n3230\n3218\n3198\n3205\n3233\n3234\n3222\n3217\n3221\n3242\n3243\n3258\n3275\n3276\n3281\n3283\n3304\n3303\n3307\n3309\n3308\n3307\n3304\n3315\n3328\n3355\n3375\n3368\n3374\n3403\n3404\n3406\n3409\n3411\n3409\n3392\n3400\n3404\n3405\n3406\n3403\n3405\n3408\n3430\n3439\n3440\n3458\n3461\n3469\n3484\n3490\n3491\n3492\n3506\n3511\n3513\n3524\n3525\n3534\n3535\n3491\n3493\n3509\n3538\n3540\n3545\n3544\n3543\n3552\n3554\n3559\n3565\n3567\n3576\n3580\n3581\n3589\n3594\n3607\n3615\n3618\n3638\n3657\n3665\n3664\n3665\n3658\n3665\n3667\n3668\n3682\n3684\n3687\n3699\n3712\n3716\n3720\n3728\n3744\n3742\n3740\n3752\n3763\n3760\n3757\n3760\n3762\n3767\n3758\n3738\n3739\n3737\n3738\n3762\n3767\n3792\n3820\n3821\n3822\n3824\n3825\n3829\n3821\n3794\n3800\n3799\n3801\n3800\n3820\n3835\n3836\n3856\n3859\n3867\n3871\n3888\n3889\n3893\n3898\n3897\n3894\n3921\n3917\n3916\n3917\n3925\n3922\n3923\n3930\n3931\n3932\n3935\n3936\n3948\n3947\n3948\n3961\n3968\n3998\n3999\n4000\n4001\n3994\n3977\n3979\n3980\n3976\n3982\n3988\n3992\n4000\n4001\n4007\n4008\n4004\n4038\n4025\n4005\n3986\n3987\n3989\n3991\n3983\n3982\n4004\n4005\n4012\n4040\n4060\n4070\n4064\n4086\n4096\n4100\n4109\n4117\n4125\n4142\n4148\n4149\n4154\n4153\n4161\n4162\n4155\n4157\n4159\n4161\n4186\n4202\n4201\n4202\n4201\n4207\n4209\n4212\n4214\n4211\n4212\n4232\n4233\n4239\n4250\n4243\n4242\n4246\n4247\n4246\n4245\n4244\n4251\n4255\n4259\n4261\n4262\n4270\n4252\n4267\n4271\n4272\n4275\n4277\n4276\n4277\n4261\n4275\n4278\n4283\n4304\n4314\n4316\n4323\n4325\n4324\n4331\n4342\n4348\n4352\n4353\n4362\n4389\n4387\n4362\n4360\n4373\n4392\n4393\n4397\n4399\n4400\n4405\n4410\n4405\n4406\n4414\n4403\n4410\n4413\n4417\n4440\n4441\n4442\n4443\n4446\n4459\n4468\n4467\n4475\n4474\n4467\n4473\n4474\n4473\n4472\n4480\n4467\n4468\n4475\n4477\n4478\n4479\n4492\n4493\n4501\n4504\n4503\n4510\n4476\n4482\n4484\n4485\n4486\n4497\n4505\n4512\n4518\n4519\n4521\n4524\n4526\n4533\n4555\n4558\n4573\n4575\n4576\n4564\n4559\n4562\n4573\n4572\n4577\n4580\n4568\n4569\n4570\n4576\n4577\n4578\n4568\n4575\n4582\n4589\n4586\n4599\n4603\n4587\n4618\n4600\n4599\n4598\n4607\n4596\n4608\n4610\n4622\n4626\n4650\n4664\n4679\n4675\n4687\n4685\n4684\n4685\n4680\n4706\n4704\n4693\n4705\n4712\n4713\n4712\n4718\n4728\n4733\n4735\n4759\n4758\n4763\n4764\n4766\n4767\n4793\n4794\n4795\n4796\n4791\n4780\n4761\n4768\n4771\n4777\n4778\n4789\n4788\n4789\n4795\n4802\n4791\n4789\n4790\n4789\n4801\n4809\n4812\n4806\n4826\n4835\n4838\n4840\n4846\n4853\n4856\n4858\n4859\n4864\n4862\n4865\n4867\n4868\n4872\n4875\n4866\n4859\n4860\n4857\n4866\n4872\n4873\n4872\n4884\n4887\n4885\n4895\n4898\n4902\n4901\n4902\n4898\n4887\n4886\n4901\n4913\n4914\n4915\n4918\n4920\n4918\n4959\n4958\n4953\n4982\n4987\n4972\n4988\n4999\n4996\n4997\n5022\n5040\n5038\n5037\n5059\n5062\n5096\n5097\n5102\n5127\n5138\n5176\n5175\n5179\n5180\n5181\n5180\n5213\n5216\n5215\n5214\n5219\n5222\n5225\n5227\n5249\n5286\n5287\n5288\n5302\n5306\n5307\n5316\n5326\n5328\n5327\n5326\n5327\n5305\n5309\n5310\n5305\n5318\n5319\n5322\n5323\n5333\n5355\n5359\n5369\n5368\n5359\n5384\n5387\n5420\n5442\n5453\n5455\n5454\n5446\n5445\n5448\n5455\n5474\n5472\n5478\n5482\n5483\n5490\n5523\n5534\n5535\n5536\n5535\n5537\n5538\n5544\n5547\n5539\n5540\n5558\n5559\n5573\n5574\n5578\n5576\n5584\n5610\n5618\n5609\n5600\n5602\n5627\n5637\n5607\n5603\n5612\n5608\n5611\n5622\n5623\n5625\n5626\n5628\n5634\n5646\n5655\n5658\n5667\n5678\n5682\n5685\n5708\n5712\n5711\n5718\n5716\n5719\n5720\n5722\n5753\n5757\n5752\n5753\n5768\n5774\n5750\n5730\n5728\n5733\n5734\n5729\n5743\n5744\n5746\n5748\n5757\n5771\n5779\n5759\n5763\n5783\n5796\n5797\n5799\n5815\n5816\n5817\n5831\n5838\n5834\n5840\n5846\n5852\n5850\n5858\n5861\n5864\n5867\n5870\n5879\n5903\n5904\n5930\n5931\n5936\n5939\n5941\n5943\n5936\n5938\n5943\n5951\n5962\n5955\n5950\n5945\n5946\n5951\n5950\n5951\n5950\n5956\n5957\n5959\n5975\n5977\n5992\n5994\n5997\n5999\n6011\n6012\n6013\n6014\n6013\n6028\n6032\n6058\n6064\n6065\n6078\n6079\n6080\n6086\n6089\n6091\n6077\n6083\n6051\n6044\n6058\n6062\n6069\n6050\n6048\n6058\n6086\n6093\n6094\n6106\n6107\n6115\n6114\n6115\n6112\n6117\n6131\n6130\n6132\n6140\n6164\n6167\n6163\n6177\n6180\n6181\n6183\n6184\n6186\n6193\n6196\n6197\n6200\n6201\n6198\n6202\n6203\n6193\n6211\n6227\n6222\n6223\n6222\n6224\n6207\n6197\n6198\n6196\n6204\n6206\n6207\n6210\n6209\n6210\n6209\n6229\n6232\n6233\n6235\n6237\n6232\n6254\n6268\n6275\n6290\n6292\n6300\n6301\n6295\n6297\n6298\n6301\n6308\n6317\n6318\n6326\n6319\n6320\n6319\n6321\n6329\n6332\n6331\n6342\n6348\n6369\n6370\n6390\n6420\n6423\n6436\n6437\n6452\n6444\n6445\n6456\n6457\n6444\n6448\n6457\n6489\n6491\n6502\n6507\n6510\n6495\n6497\n6505\n6507\n6511\n6513\n6516\n6520\n6523\n6532\n6534\n6535\n6548\n6561\n6560\n6566\n6567\n6586\n6589\n6592\n6598\n6602\n6603\n6621\n6630\n6632\n6634\n6660\n6661\n6662\n6642\n6657\n6659\n6655\n6658\n6661\n6662\n6663\n6672\n6661\n6664\n6665\n6678\n6682\n6683\n6669\n6663\n6658\n6663\n6680\n6685\n6686\n6687\n6693\n6687\n6680\n6686\n6694\n6676\n6675\n6695\n6698\n6716\n6717\n6720\n6728\n6734\n6735\n6733\n6743\n6745\n6758\n6757\n6763\n6762\n6761\n6790\n6793\n6798\n6799\n6807\n6808\n6822\n6828\n6795\n6793\n6795\n6790\n6791\n6794\n6799\n6808\n6815\n6827\n6856\n6857\n6882\n6883\n6885\n6886\n6903\n6902\n6903\n6904\n6892\n6893\n6912\n6893\n6888\n6887\n6891\n6892\n6891\n6898\n6899\n6900\n6901\n6900\n6901\n6913\n6914\n6918\n6932\n6944\n6945\n6960\n6963\n6961\n6966\n6968\n6974\n6979\n6980\n6981\n6982\n7003\n7023\n7034\n7035\n7068\n7087\n7088\n7089\n7098\n7104\n7093\n7095\n7102\n7129\n7120\n7123\n7153\n7155\n7157\n7158\n7157\n7151\n7167\n7190\n7208\n7197\n7200\n7201\n7224\n7223\n7217\n7224\n7225\n7227\n7228\n7233\n7234\n7265\n7266\n7267\n7286\n7296\n7297\n7299\n7295\n7296\n7297\n7283\n7259\n7255\n7259\n7260\n7267\n7275\n7273\n7274\n7277\n7276\n7289\n7291\n7297\n7298\n7299\n7298\n7300\n7307\n7308\n7312\n7332\n7341\n7342\n7335\n7348\n7349\n7345\n7344\n7345\n7358\n7357\n7359\n7397\n7398\n7401\n7406\n7425\n7424\n7429\n7430\n7433\n7435\n7436\n7437\n7430\n7429\n7439\n7440\n7454\n7456\n7438\n7439\n7421\n7439\n7438\n7441\n7421\n7422\n7424\n7440")
  (time (part1 puzzle-input)) ; 1527  (15 ms)
  (time (part2 puzzle-input)) ; 1575  (15 ms)
  )
