(ns year2020.day14.part1
  (:require [ysera.test :refer [is is= is-not]]
            [clojure.string :as str :only [index-of]]))

; https://adventofcode.com/2020/day/14

(defn mask-applied-value
  {:doc "
  The bitmask is always given as a string of 36 bits.
  The current bitmask is applied to values immediately before they are written to memory:
  a 0 or 1 overwrites the corresponding bit in the value, while an X leaves the bit in the value unchanged.
  "
   :test (fn []
           (is= (mask-applied-value 2r000000000000000000000000000000001011
                                    "XXXXXXXXXXXXXXXXXXXXXXXXXXXXX1XXXX0X")
                2r000000000000000000000000000001001001))}
  [value mask]
  0)

(comment
  (def puzzle-input "mask = 0X11XX1X010X01101000X01X011101100000\nmem[4634] = 907\nmem[54949] = 444591415\nmem[5445] = 1446\nmem[2822] = 702866\nmask = 000X0001010X01111X110X1X011X01110100\nmem[37380] = 15013\nmem[10527] = 65\nmem[37825] = 1485263\nmem[18685] = 3789546\nmem[49810] = 123513\nmask = 0110XX110101X1X01001110000111000010X\nmem[10040] = 696657\nmem[20116] = 29074481\nmask = 0011001101011011100X010XX1X11XX1X100\nmem[27427] = 458\nmem[495] = 36485381\nmem[29064] = 32744\nmask = X11X1011001011X111X000X11X0101101100\nmem[53658] = 7312\nmem[22728] = 86908\nmem[12525] = 4502\nmem[37291] = 24359\nmask = 00111X1X10010X1100110X110XX111XX1100\nmem[55871] = 589570\nmem[15038] = 5937461\nmem[54949] = 657120\nmask = 0X1X1X11X101011X10XX0011001X0100000X\nmem[11248] = 9235\nmem[6448] = 416920615\nmem[13182] = 93777963\nmem[59380] = 122713\nmem[5755] = 2013351\nmask = 01110X0100X111X110X0X010000XX001X0X0\nmem[37825] = 49012808\nmem[44072] = 132971\nmem[4640] = 11215\nmem[7060] = 497\nmem[14084] = 254725\nmem[20345] = 17492548\nmask = X0X1X0XX01010111101X11000110X111X0X0\nmem[7322] = 396422\nmem[12859] = 366194\nmem[26614] = 238879122\nmem[41413] = 5075832\nmem[29380] = 32273697\nmem[31250] = 241679\nmem[49264] = 9276463\nmask = XX111X1101010111100010100111011X000X\nmem[31234] = 6327319\nmem[20442] = 7737\nmem[53573] = 29127\nmem[11418] = 5594\nmask = 01X101100X11X11XX10X00110110011X0100\nmem[29653] = 1031390200\nmem[26287] = 2055712\nmem[17079] = 16375\nmem[5855] = 4357\nmem[12362] = 1636\nmem[51925] = 1034818\nmem[32514] = 718\nmask = 01110X110XXX11111XX0010XX01101X11110\nmem[43421] = 1904\nmem[31710] = 79198345\nmem[51641] = 792\nmem[25879] = 296966\nmem[61247] = 856\nmem[28520] = 15211687\nmem[52476] = 48999\nmask = 1011XX01X10101111010X1X1011000010010\nmem[34317] = 112380\nmem[12948] = 4642664\nmem[60624] = 2058959\nmem[41589] = 131585499\nmem[37155] = 63701\nmem[58140] = 14596048\nmem[53361] = 8169\nmask = 0X101011110101X010100011001XX111011X\nmem[2516] = 159804448\nmem[56019] = 4708\nmem[2822] = 193009\nmask = 0XX01011110101111X010X110010X0011X10\nmem[58540] = 219677\nmem[27179] = 29070\nmem[10896] = 2385\nmem[27360] = 193579\nmask = X0101111010101101001X0111100X00X000X\nmem[12890] = 74431\nmem[57760] = 12122\nmem[7973] = 2850\nmem[50560] = 4870\nmem[41841] = 2335\nmask = X0110101XX011X111000011X1X0100001000\nmem[54855] = 28859\nmem[63909] = 572\nmem[10112] = 27228153\nmem[18348] = 55896\nmem[12188] = 1312\nmem[46913] = 4356\nmask = 0111XX1X01001111X110100101X10101XX01\nmem[44220] = 4035\nmem[49510] = 27112\nmem[26737] = 5127\nmem[58822] = 13458521\nmem[32583] = 9480407\nmem[19323] = 1262579\nmask = 0010X111110XX1X110X1X01010111100XX10\nmem[24061] = 11583225\nmem[38455] = 74030\nmem[24892] = 3177209\nmask = 0011000101011111100X011X01100X0010X0\nmem[13350] = 10618\nmem[912] = 79652\nmem[29354] = 4886\nmem[22547] = 544\nmem[227] = 4915806\nmem[36816] = 3549982\nmask = X111X01101X1X1111X000100X011X1X11010\nmem[44234] = 3789\nmem[63704] = 1702\nmem[22207] = 6002803\nmem[22876] = 574\nmem[53719] = 392761\nmask = 00111011X001X01X0011100X100010010101\nmem[60930] = 750211944\nmem[10639] = 41930\nmem[32869] = 938382\nmem[18899] = 6326298\nmask = XXX1001001X10X1X1X1X1000001011111X10\nmem[30328] = 803377\nmem[50352] = 129416820\nmem[28691] = 797\nmem[29517] = 5166548\nmem[29912] = 21829\nmem[26614] = 4782307\nmask = X11101X100111111XXX000X1XX00100X0110\nmem[59045] = 42934816\nmem[24442] = 180882905\nmem[47760] = 16245\nmask = XXX011110101011110X1XX100X0001010X00\nmem[48181] = 22395453\nmem[60054] = 1473575\nmem[44575] = 437231650\nmem[6675] = 422141\nmem[4144] = 73734\nmem[65235] = 603\nmem[10866] = 16037624\nmask = 01101XXX11001110101001XX00X000111010\nmem[8467] = 6633\nmem[49264] = 35317\nmask = 0X11111101010X1111000111011X00X00X1X\nmem[38989] = 126216989\nmem[32976] = 51878853\nmem[37911] = 663307\nmem[43272] = 116913133\nmem[13930] = 11309\nmem[59351] = 2263850\nmask = 1X11XX01X101X0X11000111X011011X0X000\nmem[42972] = 65537685\nmem[23265] = 341611\nmem[2913] = 1002629103\nmem[38604] = 117\nmem[10597] = 38149173\nmask = 011X11010XXX111000011000X011101X1000\nmem[24676] = 31760372\nmem[44731] = 148209\nmem[41586] = 2332900\nmem[35644] = 281\nmem[1436] = 33437\nmem[31250] = 886682\nmem[6334] = 3026475\nmask = 00111111010001X0X00000110X10101X0100\nmem[27179] = 2158488\nmem[30053] = 134079752\nmem[61619] = 1014\nmem[20069] = 9724102\nmask = 10XX101X010X011110X00X1100XX0111110X\nmem[34320] = 877592754\nmem[14396] = 7981169\nmask = 011X0011010X0111110000011X1XX1101010\nmem[61038] = 81512\nmem[35618] = 3501\nmem[22941] = 6518\nmask = X111001X0111111110000110110001X0X010\nmem[34682] = 97\nmem[56366] = 263496554\nmem[62961] = 49991623\nmask = 001X11111001X1X110110111000XX0000X11\nmem[6341] = 1421\nmem[24611] = 120993920\nmask = 101X1111110X0X11110101X01X000010010X\nmem[20485] = 5715808\nmem[22244] = 15692138\nmask = 001110110XX10X11X0110XX0X00011X10001\nmem[14849] = 284\nmem[57509] = 30506693\nmem[2158] = 17503\nmem[56184] = 130050\nmem[60746] = 507\nmask = X1101X1111000110X0100X0X111XX11X0010\nmem[60171] = 348215\nmem[7283] = 2904\nmem[9298] = 1494\nmem[6121] = 65038864\nmem[50665] = 2758625\nmask = 00101X1111010111100100X1101X1XXX0XX0\nmem[12368] = 13254764\nmem[17006] = 4886\nmem[50125] = 539\nmem[61065] = 2071\nmem[42147] = 5033\nmask = 01010110010100X1100X0000X11100X0001X\nmem[9115] = 52912116\nmem[34552] = 988\nmem[53819] = 2173617\nmem[9555] = 19134613\nmem[63704] = 53775\nmask = 01001011110X011X1X01001X0XX000101X1X\nmem[5222] = 329352\nmem[6675] = 7561112\nmask = 0X111011X1110011001100X0X10111101X00\nmem[2679] = 263\nmem[33107] = 12294\nmem[26533] = 26\nmem[6989] = 16021183\nmem[9526] = 14020\nmask = 100100100X110X1X1X1XX1110010111XX01X\nmem[45991] = 659\nmem[54561] = 192359313\nmem[16625] = 1012109\nmem[21769] = 14483\nmem[41047] = 3843578\nmask = 00011X0101010XX11X10011100000101000X\nmem[63063] = 88772\nmem[28691] = 1840439\nmem[49095] = 13533\nmem[38569] = 3963850\nmem[37631] = 17229630\nmask = 01101X111X01X1101X110001X01001010010\nmem[9975] = 106086\nmem[48788] = 1764936\nmem[42959] = 5838\nmem[11250] = 239618\nmem[47113] = 544\nmem[2822] = 6581077\nmem[12525] = 3265\nmask = 01111111X1010111X0001X100110010X0X01\nmem[27284] = 6821\nmem[21759] = 15665251\nmem[30823] = 120323\nmem[19505] = 14353279\nmem[39782] = 307874155\nmem[24061] = 15198\nmask = 01111X110101X11X10111X10X1001X1X000X\nmem[37663] = 5911411\nmem[29380] = 85209498\nmem[23647] = 243\nmem[45231] = 35830\nmask = 01110011X100111111100110X10011X01X11\nmem[20886] = 4537\nmem[12297] = 1629\nmem[60297] = 43447\nmem[46364] = 814453320\nmask = 0XX01111X10XXX10X00100000011011101X0\nmem[10128] = 9549\nmem[61903] = 1996\nmem[27405] = 1587\nmem[2679] = 45513040\nmask = 011X10111101011110110X0X00011000X001\nmem[49219] = 43638\nmem[972] = 51647\nmem[24865] = 850379117\nmem[35684] = 5096007\nmask = X1111X110010X1111100100X0XX0011XX01X\nmem[18907] = 633\nmem[54569] = 239677359\nmem[56790] = 931635\nmem[32827] = 181441\nmem[46211] = 2592\nmem[38622] = 99\nmask = 101X00X1010101111X11100000X10111X111\nmem[22205] = 116543101\nmem[35762] = 82569329\nmem[9713] = 897774801\nmem[59137] = 465011\nmask = 01X101100101XXX11X0X00XX111000X10011\nmem[49510] = 4013\nmem[37268] = 11930096\nmem[49716] = 2313\nmem[31868] = 57339\nmem[39897] = 1688837\nmask = X01X10X11101011X1X0XX010011X0101X001\nmem[7716] = 1938\nmem[43453] = 1599594\nmem[13162] = 8174414\nmem[6989] = 1104673\nmem[396] = 416\nmem[30813] = 90633769\nmask = 01X011X10001X1100001100001X11010000X\nmem[52346] = 30663\nmem[33601] = 69756\nmem[37268] = 3792\nmem[53782] = 81029429\nmem[9975] = 3917934\nmask = 0011111101X10X10X0X00011X110X0X1100X\nmem[11088] = 839502\nmem[11443] = 152590965\nmem[12362] = 437\nmem[22876] = 59905\nmask = 0X11001100101111X1101X0000100001100X\nmem[881] = 2540\nmem[41431] = 82050989\nmem[44733] = 184264\nmask = 0111X111000X111110000X01X011X1000000\nmem[29534] = 60069\nmem[45094] = 173463179\nmem[38646] = 556512138\nmem[50352] = 2418\nmask = X01X111101X10010100X0010011101001000\nmem[65388] = 58820\nmem[47582] = 209297\nmem[7544] = 906\nmem[12246] = 1008999\nmem[9647] = 5611\nmask = 0XX1101XX001X0X100110110001111X0101X\nmem[27514] = 444\nmem[14660] = 62026457\nmask = 011X001101X111111100010X00X10X000100\nmem[30494] = 2661\nmem[33720] = 823\nmem[46563] = 924\nmem[56963] = 664131835\nmem[5111] = 19659\nmask = 1011X0010101101XX000X0000X0110111000\nmem[34629] = 98971417\nmem[40782] = 203196\nmem[28134] = 395046\nmem[26546] = 8144219\nmem[48190] = 99388222\nmask = 000110X0XX01X11110X1X10001000011X001\nmem[46867] = 30971\nmem[16411] = 88270\nmem[50915] = 535967\nmem[21513] = 348047\nmem[63704] = 10230355\nmem[63048] = 17068278\nmem[48970] = 5228\nmask = 0010111X11X01111100X10000XX01X000000\nmem[20345] = 175241457\nmem[27179] = 1296\nmem[27126] = 1827043\nmask = X0101X11110X0110XXX100111010X111XX00\nmem[37268] = 51456603\nmem[10417] = 8798516\nmem[4485] = 95948398\nmem[8642] = 779931\nmask = 01X1001XX11111X100000100100000100111\nmem[11794] = 415902\nmem[546] = 2169\nmem[32486] = 13281164\nmask = 0X111X1101110X100X000X1001110101010X\nmem[22108] = 111982252\nmem[43748] = 78425\nmem[34629] = 306\nmem[47753] = 131353739\nmask = 011011X1XX011110X00100X0X1111XX1010X\nmem[11269] = 155703\nmem[35544] = 32531224\nmem[52896] = 1233236\nmem[4143] = 737957\nmem[40320] = 247\nmem[6351] = 27827\nmem[50497] = 271\nmask = 01101111110XX11010100000X0000X11X010\nmem[58794] = 123769809\nmem[62949] = 31582\nmem[13930] = 1992650\nmem[49248] = 2358\nmask = 1111X0110X1X0111110X1X00X1000X111X10\nmem[21889] = 30250288\nmem[9042] = 107142\nmem[23279] = 461035\nmem[29517] = 1123\nmem[23972] = 67432\nmem[33809] = 638702339\nmem[15521] = 2476\nmask = 0X11011101X1X1X110111110X01101X01100\nmem[32705] = 118666\nmem[55232] = 1773866\nmem[43500] = 21442\nmem[35684] = 1555\nmem[25276] = 954\nmem[40811] = 9208696\nmem[26437] = 32497\nmask = 0111X11100101111110X1X00X00110X111X0\nmem[18391] = 767342723\nmem[64055] = 38122\nmem[22094] = 149640311\nmem[25472] = 645102\nmem[20761] = 2750\nmem[25339] = 25819361\nmask = 011XX1110101011110X101101X11101011X0\nmem[51881] = 3666692\nmem[52701] = 6590\nmem[20991] = 3369\nmem[46342] = 4894\nmask = 0X101X111X01011X101X00110001X0100XX0\nmem[11252] = 1994\nmem[20741] = 9297955\nmask = XX110XX10X011X111000X01001111XX11000\nmem[46854] = 398972\nmem[52634] = 51020\nmem[23052] = 302017\nmem[20442] = 1413\nmem[18068] = 422217535\nmem[26346] = 16548426\nmask = 1X1X00010X011X11100010011X110X00110X\nmem[28595] = 1419614\nmem[32724] = 69630\nmem[10772] = 965\nmem[12362] = 1856573\nmask = 001XX1X1110101111001001110X10X110X11\nmem[2679] = 597\nmem[14201] = 3287586\nmem[48499] = 31534\nmem[40434] = 30832\nmem[60646] = 4788156\nmask = 001X1111100101X1X01100X110100010X010\nmem[9846] = 44720410\nmem[11252] = 358945775\nmem[61247] = 6242\nmem[11248] = 2180\nmem[43748] = 59259664\nmask = X01011111100011X110XX01010X101110000\nmem[8508] = 450888237\nmem[15242] = 941271822\nmem[53719] = 435898962\nmask = X0110X01000110X1100X010001110XX1X01X\nmem[24163] = 19965416\nmem[33463] = 142990\nmem[27298] = 61516\nmem[56366] = 4672568\nmask = 00111X110111011000X00X1101X1X10X1100\nmem[56172] = 12\nmem[17800] = 2992383\nmem[25002] = 89527\nmem[12244] = 809\nmem[49958] = 392741\nmem[28940] = 884600\nmask = X11XX001XX11110110001011X00100010000\nmem[8273] = 19574791\nmem[33828] = 2088\nmem[45777] = 28558\nmem[7847] = 31760\nmem[63891] = 868564\nmask = 01111111XXX101111001X101101X1X0X0111\nmem[50761] = 407\nmem[10181] = 675468\nmem[30060] = 201031\nmem[9713] = 7521152\nmem[25778] = 108639\nmem[15272] = 3161\nmask = 01X10XX00101001111001XXXXX1110000011\nmem[22094] = 636723\nmem[39113] = 60654\nmem[61381] = 946758957\nmem[4474] = 1035138754\nmem[16664] = 15926\nmem[60370] = 36434\nmask = 01X1011X010101111XX0010X11000X100100\nmem[34381] = 1821811\nmem[10084] = 618\nmem[38455] = 34253\nmem[42651] = 2883\nmem[2679] = 515927386\nmask = 0111X111010101111X0XX111011XX11X0100\nmem[59504] = 73026\nmem[61065] = 1003897\nmem[21822] = 19172\nmem[18899] = 546\nmem[32907] = 1038115\nmem[23647] = 3011\nmem[59088] = 878373849\nmask = 10101111X101011X1XX10111X00X001X0X0X\nmem[40320] = 11198\nmem[16676] = 13399\nmem[5445] = 12173642\nmem[35134] = 1037649143\nmask = 00X01111010101101001X011X011XX110000\nmem[61750] = 1194\nmem[7040] = 3663944\nmem[40769] = 6278226\nmask = 0111XX1X010011111X001100111111101100\nmem[22244] = 22188053\nmem[47799] = 3685\nmem[25708] = 75747\nmem[64831] = 4756375\nmem[34046] = 164285\nmem[50578] = 11937455\nmask = X1110X1101011X111XXX1010001X01X0X101\nmem[62500] = 4671325\nmem[58692] = 795322324\nmem[16015] = 768\nmask = X110111111010X101011000100100X10XX00\nmem[32976] = 31923\nmem[8466] = 239391\nmem[6221] = 16243452\nmem[16595] = 445893\nmask = 0X101X11010XX1101001000101100111X01X\nmem[13683] = 9962888\nmem[972] = 402033884\nmask = 011101110X1X11X11100010X101101010100\nmem[13627] = 7499\nmem[63925] = 5611\nmem[31710] = 8173\nmem[41589] = 15062\nmask = 011101X1001X1111X0000X001001001X1X00\nmem[38904] = 59776\nmem[40992] = 61129\nmem[21672] = 2892903\nmem[64012] = 6840045\nmem[27298] = 28347317\nmem[44711] = 11192\nmem[42288] = 244911\nmask = 001000110X11111110X0010111X001X0X111\nmem[58822] = 33289\nmem[56527] = 193878164\nmem[48593] = 15520289\nmem[56511] = 7485107\nmask = 1011X0100101X11X10111110001X11101X01\nmem[54625] = 613806\nmem[1660] = 28678912\nmem[42420] = 345449\nmask = 0X1XX000010101111X1100XX0X10X101000X\nmem[16414] = 18061\nmem[62500] = 9781513\nmem[27160] = 86\nmem[30053] = 62630281\nmask = 0111011X0XX1X1111X010110X1000X10X1X0\nmem[15140] = 6421\nmem[44559] = 14824389\nmem[51021] = 989171\nmem[7013] = 96616\nmask = 0XX010111101X11110010010X00000111010\nmem[26533] = 18441\nmem[11274] = 42077\nmem[7604] = 71694078\nmem[12343] = 80225\nmem[50320] = 152\nmem[44463] = 994\nmem[35173] = 200567\nmask = 0111011X010011X1X100010XXX01X0111100\nmem[14911] = 698\nmem[16834] = 1246858\nmem[17006] = 244\nmem[48839] = 1074\nmask = 0X1X0011011111X1X000X11X11000X01XX11\nmem[12368] = 3510868\nmem[33320] = 53294034\nmem[48579] = 15039")
  ;  (time (part1 puzzle-input))
  ;(time (part2 puzzle-input))
  )